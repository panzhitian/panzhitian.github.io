<!doctype html><html class="theme-next pisces use-motion"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><link href="https://staticfile.qnssl.com/fancybox/2.1.5/jquery.fancybox.min.css" rel="stylesheet" type="text/css"><link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css"><link href="https://staticfile.qnssl.com/font-awesome/4.5.0/css/font-awesome.min.css" rel="stylesheet" type="text/css"><link href="/css/main.css?v=5.0.1.0519" rel="stylesheet" type="text/css"><meta name="keywords" content="Https,Let's Encrypt,SSL证书,nignx,"><link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.0.1.0519"><meta name="description" content="Let’s Encrypt是一群国外技术大牛发起的一个免费SSL证书签署的项目，背后有Mozilla、Akamai、Cisco、Chrome、Facebook等巨头的支持，详见该网页。"><meta property="og:type" content="article"><meta property="og:title" content="Let's Encrypt SSL免费证书安装与配置"><meta property="og:url" content="https://poonchit.im/2016/02/01/letsencrypt-setup-nignx-configure/index.html"><meta property="og:site_name" content="Return2legacy"><meta property="og:description" content="Let’s Encrypt是一群国外技术大牛发起的一个免费SSL证书签署的项目，背后有Mozilla、Akamai、Cisco、Chrome、Facebook等巨头的支持，详见该网页。"><meta property="og:image" content="https://o2j33qhs6.qnssl.com/images/letsencrypt-ecc-nginx/0.jpg"><meta property="og:updated_time" content="2016-03-23T15:52:42.473Z"><meta name="twitter:card" content="summary"><meta name="twitter:title" content="Let's Encrypt SSL免费证书安装与配置"><meta name="twitter:description" content="Let’s Encrypt是一群国外技术大牛发起的一个免费SSL证书签署的项目，背后有Mozilla、Akamai、Cisco、Chrome、Facebook等巨头的支持，详见该网页。"><script type="text/javascript" id="hexo.configuration">var NexT=window.NexT||{},CONFIG={scheme:"Pisces",sidebar:{position:"left",display:"post"},fancybox:!0,motion:!0,duoshuo:{userId:0,author:"博主"}}</script><title>Let's Encrypt SSL免费证书安装与配置 | Return2legacy</title></head><body itemscope="" itemtype="http://schema.org/WebPage" lang="zh-Hans"><div class="container one-collumn sidebar-position-left page-post-detail"><div class="headband"></div><header id="header" class="header" itemscope="" itemtype="http://schema.org/WPHeader"><div class="header-inner"><div class="site-meta"><div class="custom-logo-site-title"><a href="/" class="brand" rel="start"><span class="logo-line-before"><i></i></span> <span class="site-title">Return2legacy</span> <span class="logo-line-after"><i></i></span></a></div><p class="site-subtitle">Write and Share</p></div><div class="site-nav-toggle"><button><span class="btn-bar"></span> <span class="btn-bar"></span> <span class="btn-bar"></span></button></div><nav class="site-nav"><ul id="menu" class="menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="menu-item-icon fa fa-fw fa-home"></i><br>首页</a></li><li class="menu-item menu-item-archives"><a href="/archives" rel="section"><i class="menu-item-icon fa fa-fw fa-archive"></i><br>归档</a></li><li class="menu-item menu-item-tags"><a href="/tags" rel="section"><i class="menu-item-icon fa fa-fw fa-tags"></i><br>标签</a></li></ul></nav></div></header><main id="main" class="main"><div class="main-inner"><div class="content-wrap"><div id="content" class="content"><div id="posts" class="posts-expand"><article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article"><header class="post-header"><h1 class="post-title" itemprop="name headline">Let's Encrypt SSL免费证书安装与配置</h1><div class="post-meta"><span class="post-time"><span class="post-meta-item-icon"><i class="fa fa-calendar-o"></i> </span><span class="post-meta-item-text">发表于</span> <time itemprop="dateCreated" datetime="2016-02-01T09:39:22+08:00" content="2016-02-01">2016-02-01 </time></span><span class="post-category">&nbsp; | &nbsp; <span class="post-meta-item-icon"><i class="fa fa-folder-o"></i> </span><span class="post-meta-item-text">分类于</span> <span itemprop="about" itemscope="" itemtype="https://schema.org/Thing"><a href="/categories/笔记/" itemprop="url" rel="index"><span itemprop="name">笔记</span> </a></span>， <span itemprop="about" itemscope="" itemtype="https://schema.org/Thing"><a href="/categories/笔记/Let-s-Encrypt/" itemprop="url" rel="index"><span itemprop="name">Let's Encrypt</span> </a></span></span><span class="post-comments-count">&nbsp; | &nbsp; <a href="/2016/02/01/letsencrypt-setup-nignx-configure/#comments" itemprop="discussionUrl"><span class="post-comments-count ds-thread-count" data-thread-key="2016/02/01/letsencrypt-setup-nignx-configure/" itemprop="commentsCount"></span></a></span></div></header><div class="post-body" itemprop="articleBody"><p>Let’s Encrypt是一群国外技术大牛发起的一个免费SSL证书签署的项目，背后有Mozilla、Akamai、Cisco、Chrome、Facebook等巨头的支持，详见该<a href="https://letsencrypt.org/sponsors/" rel="external nofollow" target="_blank">网页</a>。<br><img src="https://o2j33qhs6.qnssl.com/images/letsencrypt-ecc-nginx/0.jpg" alt=""><br><a id="more"></a></p><p>目前签发免费SSL证书的有国外的startssl和国内wosign。但是前者所用的证书在2013年-1014年期间曾经被墙，其稳定性也是令人有点担忧。而后者，虽说全中文操作，但是天朝产物用气量多多少少也会有点膈应。<br>Let’s Encrypt的出现也是令人十分期待。其<a href="https://letsencrypt.org/2014/11/18/announcing-lets-encrypt.html" rel="external nofollow" target="_blank">目标</a>是：免费、自动化、安全、透明、开发、协作性。当然，这些都本该有的特点。两年的发展到目前其根证书已被各大浏览器所信任，兼容性可观。2015年12月，Let’s Encrypt终于迎来了公测。</p><h3 id="官方网址"><a href="#官方网址" class="headerlink" title="官方网址"></a>官方网址</h3><p>官方网站：<a href="https://letsencrypt.org/" rel="external nofollow" target="_blank">https://letsencrypt.org/</a><br>项目主页：<a href="https://github.com/letsencrypt/letsencrypt" rel="external nofollow" target="_blank">https://github.com/letsencrypt/letsencrypt</a></p><h3 id="安装客户端"><a href="#安装客户端" class="headerlink" title="安装客户端"></a>安装客户端</h3><p>听说在内测期间官方的客户端极其难用，这些搞技术的来搞产品当然是欠缺少许的了。现在的客户端虽有bug，但是操作还是比较简单的。目前官方只可在linux上运行签发，win上仅有测试版。下面是以linux的vps来记录。<br>首先要先安装<code>git</code>，然后下载Let’s Encrypt的客户端然后运行。要注意运行脚本会检测80端口等占用，所以最好先停用<code>nignx</code>等。<br></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">service nginx stop</span><br></pre></td></tr></table></figure><p></p><h4 id="standalone模式"><a href="#standalone模式" class="headerlink" title="standalone模式"></a>standalone模式</h4><p>目前相对简单的模式<br></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">git <span class="built_in">clone</span> https://github.com/letsencrypt/letsencrypt</span><br><span class="line"><span class="built_in">cd</span> letsencrypt</span><br><span class="line">./letsencrypt-auto certonly --standalone --agree-tos --email email@email.com <span class="operator">-d</span> poonchit.im <span class="operator">-d</span> www.poonchit.im</span><br></pre></td></tr></table></figure><p></p><p>说明：<br><code>--standalone</code> 本地服务器模式<br><code>--agree-tos</code> 接受协议，避免了gui出现并要手动确认<br><code>--email</code> 后面接邮箱地址作为备忘收件<br><code>-d</code> 后面接需要签发的域名</p><h3 id="成功提示"><a href="#成功提示" class="headerlink" title="成功提示"></a>成功提示</h3><p>如果没有出错就会出现以下输出：<br></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">IMPORTANT NOTES:</span><br><span class="line"> - If you lose your account credentials, you can recover through</span><br><span class="line">   e-mails sent to sammy@digitalocean.com</span><br><span class="line"> - Congratulations! Your certificate and chain have been saved at</span><br><span class="line">   /etc/letsencrypt/live/poonchit.im/fullchain.pem. Your</span><br><span class="line">   cert will expire on <span class="number">2016</span>-xx-xx. To obtain a new version of the</span><br><span class="line">   certificate <span class="keyword">in</span> the future, simply run Let<span class="string">'s Encrypt again.</span><br><span class="line"> - Your account credentials have been saved in your Let'</span>s Encrypt</span><br><span class="line">   configuration directory at /etc/letsencrypt. You should make a</span><br><span class="line">   secure backup of this folder now. This configuration directory will</span><br><span class="line">   also contain certificates and private keys obtained by Let<span class="string">'s</span><br><span class="line">   Encrypt so making regular backups of this folder is ideal.</span><br><span class="line"> - If like Let'</span>s Encrypt, please consider supporting our work by:</span><br><span class="line"></span><br><span class="line">   Donating to ISRG / Let<span class="string">'s Encrypt:   https://letsencrypt.org/donate</span><br><span class="line">   Donating to EFF:                    https://eff.org/donate-le</span></span><br></pre></td></tr></table></figure><p></p><p><code>Your certificate and chain have been saved at /etc/letsencrypt/live/poonchit.im/fullchain.pem. Your cert will expire on 2016-xx-xx.</code>说明了证书的存放位置，以及过期时间。</p><h3 id="证书说明"><a href="#证书说明" class="headerlink" title="证书说明"></a>证书说明</h3><p>证书存在了<code>/etc/letsencrypt/live/poonchit.im/</code>，里面有以下四个证书：<br><code>cert.pem</code> 域名证书<br><code>chain.pem</code> Let’s Encrypt的颁发的证书链<br><code>fullchain.pem</code> cert.pem和chain.pem的合并文件<br><code>privkey.pem</code> 证书认证的私钥</p><h3 id="nginx的配置"><a href="#nginx的配置" class="headerlink" title="nginx的配置"></a>nginx的配置</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ssl_certificate /etc/letsencrypt/live/poonchit.im/fullchain.pem;</span><br><span class="line">ssl_certificate_key /etc/letsencrypt/live/poonchit.im/privkey.pem;</span><br></pre></td></tr></table></figure><h3 id="注意事项"><a href="#注意事项" class="headerlink" title="注意事项"></a>注意事项</h3><p>Let’s Encrypt的客户端运行环境需要在Python2.7以上，在2.6下会提示实验性并使用<code>--debug</code>的flag。</p><h3 id="证书自动重签"><a href="#证书自动重签" class="headerlink" title="证书自动重签"></a>证书自动重签</h3><p>虽然Let’s Encrypt开始公测，但是目前的证书有效期只有3个月，即将到期可以手动再续签一次或者加入cron自动重签。<br>命令使用<code>--keep-until-expiring</code>或者<code>--renew-by-default</code>（后者会强制重签即使还没到期）。<br></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./letsencrypt-auto certonly --keep-until-expiring --webroot -w /home/www/poonchit.im <span class="operator">-d</span> poonchit.im,www.poonchit.im</span><br></pre></td></tr></table></figure><p></p><p>但是官方使用的是webroot模式来续签，要定位到虚拟主机的位置，这样并不方便。不过官方又给出了用standalone模式的重签脚本。<br></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="shebang">#!/bin/sh</span></span><br><span class="line">service nginx stop</span><br><span class="line"><span class="keyword">if</span> ! /path/to/letsencrypt-auto certonly -tvv --standalone --keep <span class="operator">-d</span> poonchit.im,www.poonchit.im &gt; /var/<span class="built_in">log</span>/letsencrypt/renew.log <span class="number">2</span>&gt;&amp;<span class="number">1</span> ; <span class="keyword">then</span></span><br><span class="line">    <span class="built_in">echo</span> Automated renewal failed:</span><br><span class="line">    cat /var/<span class="built_in">log</span>/letsencrypt/renew.log</span><br><span class="line">    <span class="built_in">exit</span> <span class="number">1</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line">service nginx start</span><br></pre></td></tr></table></figure><p></p><h3 id="移除证书"><a href="#移除证书" class="headerlink" title="移除证书"></a>移除证书</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./letsencrypt-auto revoke --cert-path /etc/letsencrypt/live/poonchit.im/cert.pem</span><br></pre></td></tr></table></figure><h3 id="在线生成网站"><a href="#在线生成网站" class="headerlink" title="在线生成网站"></a>在线生成网站</h3><p><a href="https://gethttpsforfree.com/" rel="external nofollow" target="_blank">https://gethttpsforfree.com/</a> （推荐，较后者安全）<br><a href="https://www.sslforfree.com/" rel="external nofollow" target="_blank">https://www.sslforfree.com/</a></p><h3 id="纯-Shell-单脚本-LetsEncrypt-客户端"><a href="#纯-Shell-单脚本-LetsEncrypt-客户端" class="headerlink" title="纯 Shell 单脚本, LetsEncrypt 客户端"></a>纯 Shell 单脚本, LetsEncrypt 客户端</h3><p>v2ex网友制作，不依赖官方客户端，不依赖<code>Python</code>。<br><a href="https://github.com/Neilpang/le" rel="external nofollow" target="_blank">https://github.com/Neilpang/le</a></p></div><div></div><div></div><footer class="post-footer"><div class="post-tags"><a href="/tags/Https/" rel="tag">#Https</a> <a href="/tags/Let-s-Encrypt/" rel="tag">#Let's Encrypt</a> <a href="/tags/SSL证书/" rel="tag">#SSL证书</a> <a href="/tags/nignx/" rel="tag">#nignx</a></div><div class="post-nav"><div class="post-nav-next post-nav-item"></div><div class="post-nav-prev post-nav-item"><a href="/2016/02/03/root-domain-cname-mx-conflict/" rel="prev" title="根域名CNAME与MX记录冲突问题">根域名CNAME与MX记录冲突问题 <i class="fa fa-chevron-right"></i></a></div></div></footer></article><div class="post-spread"></div></div></div><div class="comments" id="comments"><div class="ds-thread" data-thread-key="2016/02/01/letsencrypt-setup-nignx-configure/" data-title="Let's Encrypt SSL免费证书安装与配置" data-url="https://poonchit.im/2016/02/01/letsencrypt-setup-nignx-configure/"></div></div></div><div class="sidebar-toggle"><div class="sidebar-toggle-line-wrap"><span class="sidebar-toggle-line sidebar-toggle-line-first"></span> <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span> <span class="sidebar-toggle-line sidebar-toggle-line-last"></span></div></div><aside id="sidebar" class="sidebar"><div class="sidebar-inner"><ul class="sidebar-nav motion-element"><li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">文章目录</li><li class="sidebar-nav-overview" data-target="site-overview">站点概览</li></ul><section class="site-overview sidebar-panel"><div class="site-author motion-element" itemprop="author" itemscope="" itemtype="http://schema.org/Person"><img class="site-author-image" itemprop="image" src="https://o2j33qhs6.qnssl.com/images/avatar.jpg" alt="poonchitim"><p class="site-author-name" itemprop="name">poonchitim</p><p class="site-description motion-element" itemprop="description">无技术·爱折腾</p></div><nav class="site-state motion-element"><div class="site-state-item site-state-posts"><a href="/archives"><span class="site-state-item-count">13</span> <span class="site-state-item-name">日志</span></a></div><div class="site-state-item site-state-categories"><span class="site-state-item-count">3</span> <span class="site-state-item-name">分类</span></div><div class="site-state-item site-state-tags"><a href="/tags"><span class="site-state-item-count">36</span> <span class="site-state-item-name">标签</span></a></div></nav><div class="links-of-author motion-element"><span class="links-of-author-item"><a href="mailto:&#0112;&#00111;&#000111;&#0110;&#99;&#104;&#x0000069;&#x0000074;&#105;&#0000109;&#000064;&#000112;&#x00006f;&#111;&#000110;&#0000099;&#0104;&#000105;&#0116;&#000046;&#0000105;&#000109;" target="_blank" title="Mail"><i class="fa fa-fw fa-envelope"></i> Mail </a></span><span class="links-of-author-item"><a href="http://weibo.com/panzhitian" target="_blank" title="Weibo" rel="external nofollow"><i class="fa fa-fw fa-weibo"></i> Weibo </a></span><span class="links-of-author-item"><a href="https://plus.google.com/u/0/105087186123278576416" target="_blank" title="Google" rel="external nofollow"><i class="fa fa-fw fa-google"></i> Google </a></span><span class="links-of-author-item"><a href="https://github.com/panzhitian" target="_blank" title="GitHub" rel="external nofollow"><i class="fa fa-fw fa-github"></i> GitHub</a></span></div></section><section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active"><div class="post-toc"><div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-3"><a class="nav-link" href="#官方网址"><span class="nav-number">1.</span> <span class="nav-text">官方网址</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#安装客户端"><span class="nav-number">2.</span> <span class="nav-text">安装客户端</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#standalone模式"><span class="nav-number">2.1.</span> <span class="nav-text">standalone模式</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#成功提示"><span class="nav-number">3.</span> <span class="nav-text">成功提示</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#证书说明"><span class="nav-number">4.</span> <span class="nav-text">证书说明</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#nginx的配置"><span class="nav-number">5.</span> <span class="nav-text">nginx的配置</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#注意事项"><span class="nav-number">6.</span> <span class="nav-text">注意事项</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#证书自动重签"><span class="nav-number">7.</span> <span class="nav-text">证书自动重签</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#移除证书"><span class="nav-number">8.</span> <span class="nav-text">移除证书</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#在线生成网站"><span class="nav-number">9.</span> <span class="nav-text">在线生成网站</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#纯-Shell-单脚本-LetsEncrypt-客户端"><span class="nav-number">10.</span> <span class="nav-text">纯 Shell 单脚本, LetsEncrypt 客户端</span></a></li></ol></div></div></section></div></aside></div></main><footer id="footer" class="footer"><div class="footer-inner"><div class="copyright">&copy; 2015 - <span itemprop="copyrightYear">2016</span> <span class="with-love"><i class="fa fa-heart"></i> </span><span class="author" itemprop="copyrightHolder">poonchitim</span></div><div class="powered-by">由 <a class="theme-link" href="http://hexo.io" rel="external nofollow" target="_blank">Hexo</a> 强力驱动</div><div class="theme-info">主题 - <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next" rel="external nofollow" target="_blank">NexT.Pisces</a></div></div></footer><div class="back-to-top"><i class="fa fa-arrow-up"></i></div></div><script type="text/javascript">"[object Function]"!==Object.prototype.toString.call(window.Promise)&&(window.Promise=null)</script><script type="text/javascript" src="https://staticfile.qnssl.com/jquery/2.1.3/jquery.min.js"></script><script type="text/javascript" src="https://staticfile.qnssl.com/fastclick/1.0.6/fastclick.min.js"></script><script type="text/javascript" src="https://staticfile.qnssl.com/jquery_lazyload/1.9.7/jquery.lazyload.min.js"></script><script type="text/javascript" src="https://staticfile.qnssl.com/velocity/1.2.1/velocity.min.js"></script><script type="text/javascript" src="https://staticfile.qnssl.com/velocity/1.2.1/velocity.ui.min.js"></script><script type="text/javascript" src="https://staticfile.qnssl.com/fancybox/2.1.5/jquery.fancybox.min.js"></script><script type="text/javascript" src="/js/src/utils.js?v=5.0.1.0519"></script><script type="text/javascript" src="/js/src/motion.js?v=5.0.1.0519"></script><script type="text/javascript" src="/js/src/affix.js?v=5.0.1.0519"></script><script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.0.1.0519"></script><script type="text/javascript" src="/js/src/scrollspy.js?v=5.0.1.0519"></script><script type="text/javascript" src="/js/src/post-details.js?v=5.0.1.0519"></script><script type="text/javascript" src="/js/src/bootstrap.js?v=5.0.1.0519"></script><script type="text/javascript">var duoshuoQuery={short_name:"poonchitim"};!function(){var t=document.createElement("script");t.type="text/javascript",t.async=!0,t.id="duoshuo-script",t.src=("https:"==document.location.protocol?"https:":"http:")+"//o2j33qhs6.qnssl.com/js/src/duoshuo/embed.js",t.charset="UTF-8",(document.getElementsByTagName("head")[0]||document.getElementsByTagName("body")[0]).appendChild(t)}()</script></body></html>